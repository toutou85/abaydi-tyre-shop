<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¹Ø¨Ø§ÙŠØ¯ÙŠ Ù„Ù„Ø¹Ø¬Ù„Ø§Øª</title>
  <style>
    body { font-family: "Tajawal", Arial, sans-serif; background:#f2f2f2; margin:0; padding:0; }
    header { background:#007bff; color:#fff; padding:14px; text-align:center; font-size:1.2rem; }
    .searchBox { width:95%; max-width:1200px; margin:14px auto; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; }
    label { font-size:0.95rem; margin-inline-start:6px; }
    select, button { padding:8px 10px; font-size:0.95rem; border:1px solid #ccc; border-radius:6px; background:#fff; }
    button { background:#28a745; color:#fff; border:none; cursor:pointer; }
    .products { width:95%; max-width:1200px; margin:12px auto 40px; display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:14px; }
    .card { background:#fff; border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); text-align:center; position:relative; }
    .card img { width:100%; height:140px; object-fit:contain; border-radius:8px; background:#fafafa; }
    .card h3 { margin:10px 0 6px; font-size:1rem; color:#333; }
    .price { color:#007bff; font-weight:700; margin-bottom:8px; }
    .btn-order { background:#007bff; color:#fff; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
    .badge { position:absolute; left:10px; top:10px; padding:6px 8px; border-radius:6px; font-size:0.85rem; color:#fff; }
    .available { background:#28a745; }
    .unavailable { background:#d9534f; }
    .info { text-align:center; color:#666; margin-top:6px; font-size:0.95rem; }
    @media (max-width:700px){ .searchBox{flex-direction:column; align-items:stretch;} select, button{width:100%;} }
  </style>
</head>
<body>
  <header>ğŸ› Ø¹Ø¨Ø§ÙŠØ¯ÙŠ Ù„Ù„Ø¹Ø¬Ù„Ø§Øª</header>

  <div class="searchBox" aria-label="ÙÙ„ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª">
    <div>
      <label for="width">Ø§Ù„Ø¹Ø±Ø¶</label><br>
      <select id="width" aria-label="Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø·Ø§Ø±">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <!-- Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ (125 - 315) -->
        <option>125</option><option>135</option><option>145</option><option>155</option>
        <option>165</option><option>175</option><option>185</option><option>195</option>
        <option>205</option><option>215</option><option>225</option><option>235</option>
        <option>245</option><option>255</option><option>265</option><option>275</option>
        <option>285</option><option>295</option><option>305</option><option>315</option>
      </select>
    </div>

    <div>
      <label for="aspect">Ø§Ù„Ù†Ø³Ø¨Ø©</label><br>
      <select id="aspect" aria-label="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø·Ø§Ø±">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <!-- Ù†Ø³Ø¨Ø© ÙƒØ§Ù…Ù„Ø© (25 - 85) -->
        <option>25</option><option>30</option><option>35</option><option>40</option>
        <option>45</option><option>50</option><option>55</option><option>60</option>
        <option>65</option><option>70</option><option>75</option><option>80</option>
        <option>85</option>
      </select>
    </div>

    <div>
      <label for="diameter">Ø§Ù„Ù‚Ø·Ø±</label><br>
      <select id="diameter" aria-label="Ù‚Ø·Ø± Ø§Ù„Ø¬Ù†Ø·">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <!-- Ù‚Ø·Ø± ÙƒØ§Ù…Ù„ (10 - 24) -->
        <option>10</option><option>11</option><option>12</option><option>13</option>
        <option>14</option><option>15</option><option>16</option><option>17</option>
        <option>18</option><option>19</option><option>20</option><option>21</option>
        <option>22</option><option>23</option><option>24</option>
      </select>
    </div>

    <div>
      <button id="resetBtn" type="button">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„</button>
    </div>
  </div>

  <div class="products" id="productsBox" aria-live="polite">
    <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬Ù‡Ø§ Ù‡Ù†Ø§ -->
  </div>

  <div class="info">Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ø³ÙˆÙ ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙƒÙ… ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†.</div>

<script>
  // Ø±Ø§Ø¨Ø· Google Sheets (CSV Ù…Ù†Ø´ÙˆØ±) â€” ØºÙŠÙ‘Ø±Ù‡ Ø¥Ø°Ø§ Ù„Ø²Ù…
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBz1iucjkuwAG78fd6m1zE4oXKuaZzlgVGO7cK1uts7UkTFgT0nxpqXA-ovj8iOa9FhujqCSpxHrXw/pub?output=csv";

  const box = document.getElementById('productsBox');
  const widthSel = document.getElementById('width');
  const aspectSel = document.getElementById('aspect');
  const diameterSel = document.getElementById('diameter');
  const resetBtn = document.getElementById('resetBtn');

  let products = [];

  // Ø¯Ø§Ù„Ø© ÙÙƒ CSV ØªØ¯Ø¹Ù… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø·Ø© Ø¨Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³
  function parseCSV(text) {
    text = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n");
    const rows = [];
    let cur = "", row = [], inQuotes = false;
    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      if (ch === '"') {
        if (inQuotes && text[i+1] === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if (ch === "," && !inQuotes) {
        row.push(cur);
        cur = "";
      } else if (ch === "\n" && !inQuotes) {
        row.push(cur);
        rows.push(row);
        row = [];
        cur = "";
      } else {
        cur += ch;
      }
    }
    if (cur !== "" || row.length) { row.push(cur); rows.push(row); }
    return rows.filter(r => r.some(c => c && c.trim() !== ""));
  }

  // ØªØ·Ø¨ÙŠØ¹ Ù„Ù„Ù†Øµ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Ù†Ù…Ø³Ø­ Ù…Ø³Ø§ÙØ§ØªØŒ Ø´Ø±Ø·Ø§ØªØŒ Ø´Ø±Ø·Ø© Ù…Ø§Ø¦Ù„Ø©ØŒ Ù†Ø­Ùˆ R ÙˆÙ†ØªØ­ÙˆÙ„ Ù„Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø©)
  function normalize(str) {
    return String(str || "").toUpperCase().replace(/\s+|\/|-|â€“|â€”/g, "");
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª
  fetch(sheetUrl)
    .then(r => {
      if (!r.ok) throw new Error("ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Google Sheets");
      return r.text();
    })
    .then(txt => {
      const rows = parseCSV(txt);
      // Ù†ØªÙˆÙ‚Ø¹: Ø¹Ù…ÙˆØ¯ 0 = fullName (Ù…Ø«Ø§Ù„: 185/65 R14) ØŒ Ø¹Ù…ÙˆØ¯1 = price ØŒ Ø¹Ù…ÙˆØ¯2 = qty (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ØŒ Ø¹Ù…ÙˆØ¯3 = image (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      const dataRows = rows.slice(1); // Ù†ØªØ®Ø·Ù‰ Ø§Ù„Ø±Ø£Ø³ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
      products = dataRows.map(cols => ({
        fullName: (cols[0] || "").trim(),
        price: (cols[1] || "").trim(),
        qty: (cols[2] || "").trim(),      // Ù‚Ø¯ ÙŠÙƒÙˆÙ† ÙØ§Ø±Øº
        image: (cols[3] || "").trim()
      })).filter(p => p.fullName); // Ù†Ù„ØºÙŠ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
      displayProducts(products);
    })
    .catch(err => {
      box.innerHTML = `<div style="grid-column:1/-1;color:red;text-align:center;padding:16px;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${err.message}</div>`;
      console.error(err);
    });

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
  function displayProducts(list) {
    if (!list || list.length === 0) {
      box.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:18px;background:#fff;border-radius:8px;">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>`;
      return;
    }
    box.innerHTML = "";
    for (const p of list) {
      const imageUrl = p.image || "https://via.placeholder.com/400x300?text=%D8%B5%D9%88%D8%B1%D8%A9+%D8%B9%D8%AF%D9%85"; // Ø§Ø­ØªÙŠØ§Ø·
      // Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙØ±: Ø¥Ø°Ø§ Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…Ø¹Ø·Ø§Ø© Ø§Ø¹ØªØ¨Ø± Ù…ØªÙˆÙØ±ØŒ Ø¥Ø°Ø§ Ù…Ø¹Ø·Ø§Ø© Ùˆ >0 Ù…ØªÙˆÙØ±ØŒ ÙˆØ¥Ù„Ø§ ØºÙŠØ± Ù…ØªÙˆÙØ±
      let available = true;
      if (p.qty !== undefined && p.qty !== null && p.qty !== "") {
        const n = Number(String(p.qty).replace(/\D/g,'')); // Ù†Ø£Ø®Ø° Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
        available = !isNaN(n) ? n > 0 : true;
      }
      box.insertAdjacentHTML('beforeend', `
        <div class="card" role="article">
          <div class="${available ? 'badge available' : 'badge unavailable'}">${available ? 'âœ… Ù…ØªÙˆÙØ±' : 'âŒ ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(p.fullName)}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
          <h3>${escapeHtml(p.fullName)}</h3>
          <div class="price">${escapeHtml(p.price || '-')} Ø¯Ø¬</div>
          <button class="btn-order" onclick="orderProduct('${escapeJs(p.fullName)}')">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
        </div>
      `);
    }
  }

  // ÙÙ„ØªØ±Ø© Ø°ÙƒÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠØ¹
  function filterProducts() {
    const w = widthSel.value.trim();
    const a = aspectSel.value.trim();
    const d = diameterSel.value.trim();

    let filtered = products.slice();

    if (w) {
      const nw = normalize(w);
      filtered = filtered.filter(p => normalize(p.fullName).includes(nw));
    }
    if (a) {
      const na = normalize(a);
      filtered = filtered.filter(p => normalize(p.fullName).includes(na));
    }
    if (d) {
      // Ù†ÙØ­Øµ Ø¹Ù„Ù‰ R + d Ø£Ùˆ d Ù…Ø³Ø¨ÙˆÙ‚Ø© Ø¨Ù€R Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ
      const nd = normalize("R" + d);
      filtered = filtered.filter(p => normalize(p.fullName).includes(nd));
    }

    displayProducts(filtered);
  }

  // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„
  resetBtn.addEventListener('click', () => {
    widthSel.value = "";
    aspectSel.value = "";
    diameterSel.value = "";
    displayProducts(products);
  });

  // ÙÙ„ØªØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ select
  widthSel.addEventListener('change', filterProducts);
  aspectSel.addEventListener('change', filterProducts);
  diameterSel.addEventListener('change', filterProducts);

  // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø£Ù…Ø§Ù†
  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
  function escapeJs(s){ return String(s||'').replace(/'/g,"\\'").replace(/"/g,'\\"'); }

  // ØªØ§Ø¨Ø¹ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø²Ø± "Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†" â€” Ø¹Ø¯Ù„Ù‡ Ø­Ø³Ø¨ Ø­Ø§Ø¬ØªÙƒ (Ù†Ù…ÙˆØ°Ø¬ØŒ ØªØ­ÙˆÙŠÙ„ Ù„ØµÙØ­Ø© Ø·Ù„Ø¨ØŒ Ø¥Ù„Ø®.)
  function orderProduct(name){
    // Ù…Ø«Ø§Ù„: ØªØ¸Ù‡Ø± Ù†Ø§ÙØ°Ø© Ø¨Ø³ÙŠØ·Ø© Ø«Ù… ØªÙˆØ¬ÙŠÙ‡ Ø£Ùˆ ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬
    const confirmed = confirm(`Ø·Ù„Ø¨: ${name}\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ØŸ`);
    if (confirmed) {
      // Ù‡Ù†Ø§ ØªØ¶Ø¹ Ø³Ù„ÙˆÙƒ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
      alert('Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ (ØªØ·ÙˆÙŠØ± Ù„Ø§Ø­Ù‚)');
    }
  }
</script>
</body>
</html>