<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¹Ø¨Ø§ÙŠØ¯ÙŠ Ù„Ù„Ø¹Ø¬Ù„Ø§Øª</title>
  <style>
    body { font-family: "Tajawal", Arial, sans-serif; background:#f2f2f2; margin:0; padding:0; }
    header { background:#007bff; color:#fff; padding:14px; text-align:center; font-size:1.2rem; }
    .searchBox { width:95%; max-width:1200px; margin:14px auto; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; }
    label { font-size:0.95rem; margin-inline-start:6px; }
    select, button { padding:8px 10px; font-size:0.95rem; border:1px solid #ccc; border-radius:6px; background:#fff; }
    button { background:#28a745; color:#fff; border:none; cursor:pointer; }
    .products { width:95%; max-width:1200px; margin:12px auto 40px; display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:14px; }
    .card { background:#fff; border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); text-align:center; position:relative; }
    .card img { width:100%; height:140px; object-fit:contain; border-radius:8px; background:#fafafa; }
    .card h3 { margin:10px 0 6px; font-size:1rem; color:#333; }
    .price { color:#007bff; font-weight:700; margin-bottom:8px; }
    .btn-order { background:#007bff; color:#fff; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
    .badge { position:absolute; left:10px; top:10px; padding:6px 8px; border-radius:6px; font-size:0.85rem; color:#fff; }
    .available { background:#28a745; }
    .unavailable { background:#d9534f; }
    .info { text-align:center; color:#666; margin-top:6px; font-size:0.95rem; }
    @media (max-width:700px){ .searchBox{flex-direction:column; align-items:stretch;} select, button{width:100%;} }
  </style>
</head>
<body>
  <header>ğŸ› Ø¹Ø¨Ø§ÙŠØ¯ÙŠ Ù„Ù„Ø¹Ø¬Ù„Ø§Øª</header>

  <div class="searchBox" aria-label="ÙÙ„ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª">
    <div>
      <label for="width">Ø§Ù„Ø¹Ø±Ø¶</label><br>
      <select id="width" aria-label="Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø·Ø§Ø±">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option>125</option><option>135</option><option>145</option><option>155</option>
        <option>165</option><option>175</option><option>185</option><option>195</option>
        <option>205</option><option>215</option><option>225</option><option>235</option>
        <option>245</option><option>255</option><option>265</option><option>275</option>
        <option>285</option><option>295</option><option>305</option><option>315</option>
      </select>
    </div>

    <div>
      <label for="aspect">Ø§Ù„Ù†Ø³Ø¨Ø©</label><br>
      <select id="aspect" aria-label="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø·Ø§Ø±">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option>25</option><option>30</option><option>35</option><option>40</option>
        <option>45</option><option>50</option><option>55</option><option>60</option>
        <option>65</option><option>70</option><option>75</option><option>80</option>
        <option>85</option>
      </select>
    </div>

    <div>
      <label for="diameter">Ø§Ù„Ù‚Ø·Ø±</label><br>
      <select id="diameter" aria-label="Ù‚Ø·Ø± Ø§Ù„Ø¬Ù†Ø·">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option>10</option><option>11</option><option>12</option><option>13</option>
        <option>14</option><option>15</option><option>16</option><option>17</option>
        <option>18</option><option>19</option><option>20</option><option>21</option>
        <option>22</option><option>23</option><option>24</option>
      </select>
    </div>

    <div>
      <button id="resetBtn" type="button">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„</button>
    </div>
  </div>

  <div class="products" id="productsBox" aria-live="polite"></div>

  <div class="info">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªØ¬ÙŠ Ù…Ù† Ø¬Ø¯ÙˆÙ„ Google Sheets.</div>

<script>
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBz1iucjkuwAG78fd6m1zE4oXKuaZzlgVGO7cK1uts7UkTFgT0nxpqXA-ovj8iOa9FhujqCSpxHrXw/pub?output=csv";

  const box = document.getElementById('productsBox');
  const widthSel = document.getElementById('width');
  const aspectSel = document.getElementById('aspect');
  const diameterSel = document.getElementById('diameter');
  const resetBtn = document.getElementById('resetBtn');

  let products = [];

  function parseCSV(text) {
    text = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n");
    const rows = [];
    let cur = "", row = [], inQuotes = false;
    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      if (ch === '"') {
        if (inQuotes && text[i+1] === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if (ch === "," && !inQuotes) {
        row.push(cur);
        cur = "";
      } else if (ch === "\n" && !inQuotes) {
        row.push(cur);
        rows.push(row);
        row = [];
        cur = "";
      } else {
        cur += ch;
      }
    }
    if (cur !== "" || row.length) { row.push(cur); rows.push(row); }
    return rows.filter(r => r.some(c => c && c.trim() !== ""));
  }

  function normalize(str) {
    return String(str || "").toUpperCase().replace(/\s+|\/|-|â€“|â€”/g, "");
  }

  fetch(sheetUrl)
    .then(r => r.text())
    .then(txt => {
      const rows = parseCSV(txt);
      const dataRows = rows.slice(1);
      products = dataRows.map(cols => ({
        fullName: (cols[0] || "").trim(),
        price: (cols[1] || "").trim(),
        qty: (cols[2] || "").trim(),
        image: (cols[3] || "").trim()
      })).filter(p => p.fullName);
      displayProducts(products);
    })
    .catch(err => {
      box.innerHTML = `<div style="grid-column:1/-1;color:red;text-align:center;padding:16px;">Ø®Ø·Ø£: ${err.message}</div>`;
    });

  function displayProducts(list) {
    box.innerHTML = "";
    for (const p of list) {
      const imageUrl = p.image || "https://via.placeholder.com/400x300?text=No+Image";
      let available = true;
      if (p.qty !== "") {
        const n = Number(String(p.qty).replace(/\D/g,''));
        available = !isNaN(n) ? n > 0 : true;
      }
      box.insertAdjacentHTML('beforeend', `
        <div class="card">
          <div class="${available ? 'badge available' : 'badge unavailable'}">${available ? 'âœ… Ù…ØªÙˆÙØ±' : 'âŒ ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(p.fullName)}">
          <h3>${escapeHtml(p.fullName)}</h3>
          <div class="price">${escapeHtml(p.price || '-')} Ø¯Ø¬</div>
          <button class="btn-order" onclick="orderProduct('${escapeJs(p.fullName)}','${escapeJs(p.price)}')">ğŸ“¦ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
        </div>
      `);
    }
  }

  function filterProducts() {
    const w = widthSel.value.trim();
    const a = aspectSel.value.trim();
    const d = diameterSel.value.trim();
    let filtered = products.slice();
    if (w) filtered = filtered.filter(p => normalize(p.fullName).includes(normalize(w)));
    if (a) filtered = filtered.filter(p => normalize(p.fullName).includes(normalize(a)));
    if (d) filtered = filtered.filter(p => normalize(p.fullName).includes(normalize("R"+d)));
    displayProducts(filtered);
  }

  resetBtn.addEventListener('click', () => {
    widthSel.value = ""; aspectSel.value = ""; diameterSel.value = "";
    displayProducts(products);
  });
  widthSel.addEventListener('change', filterProducts);
  aspectSel.addEventListener('change', filterProducts);
  diameterSel.addEventListener('change', filterProducts);

  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
  function escapeJs(s){ return String(s||'').replace(/'/g,"\\'").replace(/"/g,'\\"'); }

  // âœ… Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ÙŠÙˆØ¬Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„ØµÙØ­Ø© order_form.html
  function orderProduct(name, price){
    window.location.href = `order_form.html?fullName=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}`;
  }
</script>
</body>
</html>