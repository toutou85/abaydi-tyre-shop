<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¹Ø¨Ø§ÙŠØ¯ÙŠ Ù„Ù„Ø¹Ø¬Ù„Ø§Øª â€” Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</title>
  <style>
    body { font-family: 'Tajawal', Arial, sans-serif; background:#f2f2f2; margin:0; padding:20px; }
    header { background:#007bff; color:#fff; padding:12px 16px; border-radius:6px; margin-bottom:14px; text-align:center; font-size:1.2rem; }
    .searchBox { width:100%; max-width:1100px; margin:0 auto 16px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; }
    label { font-size:0.95rem; margin-right:6px; }
    select, button { padding:8px 10px; font-size:1rem; border:1px solid #ccc; border-radius:6px; background:#fff; }
    button { background:#28a745; color:#fff; border:none; cursor:pointer; }
    table { width:100%; max-width:1100px; margin:10px auto 40px; border-collapse:collapse; background:#fff; box-shadow:0 4px 18px rgba(0,0,0,0.06); border-radius:8px; overflow:hidden; }
    th, td { padding:12px; text-align:center; border-bottom:1px solid #eee; }
    th { background:#007bff; color:#fff; }
    tr:nth-child(even) td { background:#fafafa; }
    .info { text-align:center; margin-top:10px; color:#666; }
    @media (max-width:700px){
      .searchBox{flex-direction:column; gap:6px;}
      select, button{width:100%;}
    }
  </style>
</head>
<body>

  <header>ğŸ› Ù…ØªØ¬Ø± Ø¹Ø¨Ø§ÙŠØ¯ÙŠ Ù„Ù„Ø¹Ø¬Ù„Ø§Øª â€” Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</header>

  <div class="searchBox">
    <div>
      <label for="width">Ø§Ù„Ø¹Ø±Ø¶</label>
      <select id="width">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option>125</option>
        <option>135</option>
        <option>145</option>
        <option>155</option>
        <option>165</option>
        <option>175</option>
        <option>185</option>
        <option>195</option>
        <option>205</option>
        <option>215</option>
        <option>225</option>
        <option>235</option>
        <option>245</option>
        <option>255</option>
        <option>265</option>
        <option>275</option>
        <option>285</option>
        <option>295</option>
        <option>305</option>
        <option>315</option>
      </select>
    </div>

    <div>
      <label for="aspect">Ø§Ù„Ù†Ø³Ø¨Ø© (Ø§Ù„Ø§Ø±ØªÙØ§Ø¹)</label>
      <select id="aspect">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option>25</option>
        <option>30</option>
        <option>35</option>
        <option>40</option>
        <option>45</option>
        <option>50</option>
        <option>55</option>
        <option>60</option>
        <option>65</option>
        <option>70</option>
        <option>75</option>
        <option>80</option>
        <option>85</option>
      </select>
    </div>

    <div>
      <label for="diameter">Ø§Ù„Ù‚Ø·Ø±</label>
      <select id="diameter">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option>10</option>
        <option>11</option>
        <option>12</option>
        <option>13</option>
        <option>14</option>
        <option>15</option>
        <option>16</option>
        <option>17</option>
        <option>18</option>
        <option>19</option>
        <option>20</option>
        <option>21</option>
        <option>22</option>
        <option>23</option>
        <option>24</option>
      </select>
    </div>

    <div>
      <button id="searchBtn">ğŸ” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
    </div>
  </div>

  <table aria-live="polite">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
        <th>Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
      </tr>
    </thead>
    <tbody id="productsBody">
      <tr><td colspan="3">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
    </tbody>
  </table>

  <div class="info">Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ù…Ù‚Ø§Ø³ Ù…Ø§ ØªØ±ÙŠØ¯Ù‡ Ù…Ø´ Ø¸Ø§Ù‡Ø±ØŒ ØªÙ‚Ø¯Ø± ØªØ­Ø¯Ø« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Google Sheets Ø£Ùˆ ØªØ±Ø³Ù„Ù„ÙŠ Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù…Ù†ØªØ¬ Ù…ÙÙ‚ÙˆØ¯.</div>

<script>
  // Ø±Ø§Ø¨Ø· Google Sheets (CSV Ù…Ù†Ø´ÙˆØ±)
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBz1iucjkuwAG78fd6m1zE4oXKuaZzlgVGO7cK1uts7UkTFgT0nxpqXA-ovj8iOa9FhujqCSpxHrXw/pub?output=csv";

  const body = document.getElementById("productsBody");
  const widthSelect = document.getElementById("width");
  const aspectSelect = document.getElementById("aspect");
  const diameterSelect = document.getElementById("diameter");
  const searchBtn = document.getElementById("searchBtn");

  let products = [];

  // Ø¯Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ù„ÙÙƒ CSV Ù…Ø¹ Ø¯Ø¹Ù… Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ÙŠØ© "quoted"
  function parseCSV(text){
    text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
    const rows = [];
    let cur = '';
    let row = [];
    let inQuotes = false;
    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      if (ch === '"') {
        // Ø¥Ø°Ø§ Ø§Ù„ØªØ§Ù„ÙŠ " Ø£ÙŠØ¶Ø§Ù‹ ÙÙ†Ø³Ø¬Ù„Ù‡ ÙƒÙ€ "
        if (inQuotes && text[i+1] === '"') {
          cur += '"';
          i++; // ØªØ®Ø·ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ
        } else {
          inQuotes = !inQuotes;
        }
      } else if (ch === ',' && !inQuotes) {
        row.push(cur);
        cur = '';
      } else if (ch === '\n' && !inQuotes) {
        row.push(cur);
        rows.push(row);
        row = [];
        cur = '';
      } else {
        cur += ch;
      }
    }
    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚Ù„
    if (cur !== '' || row.length) {
      row.push(cur);
      rows.push(row);
    }
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ÙØ§Ø±ØºØ©
    return rows.filter(r => r.length > 1 || (r.length===1 && r[0].trim() !== ''));
  }

  // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ: Ù†Ø­Ø°Ù Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ùˆ Ø§Ù„Ø´Ø±Ø·Ø§Øª Ùˆ Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ù…Ø§Ø¦Ù„ Ø¨Ø§Ø´ Ù†Ù‚Ø§Ø±Ù† Ø¨Ø³Ù‡ÙˆÙ„Ø©ØŒ Ùˆ Ù†Ø­ÙˆÙ„ Ù„Ù„Ø­Ø±ÙˆÙ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
  function normalize(str){
    return String(str || '').toUpperCase().replace(/\s+|\/|-|-/g, '');
  }

  // Ø¬Ù„Ø¨ Ùˆ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  fetch(sheetUrl)
    .then(r => {
      if (!r.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† Google Sheets');
      return r.text();
    })
    .then(text => {
      const rows = parseCSV(text);
      // Ù†ÙØªØ±Ø¶ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø±Ø¤ÙˆØ³: Ù†Ø£Ø®Ø° Ø§Ù„Ø¨Ø§Ù‚ÙŠ
      const dataRows = rows.slice(1);
      products = dataRows.map(cols => {
        // Ø§ÙØªØ±Ø§Ø¶: Ø§Ù„Ø¹Ù…ÙˆØ¯ 0 = fullName ØŒ 1 = price ØŒ 2 = qty
        return {
          fullName: (cols[0] || '').trim(),
          price: (cols[1] || '').trim(),
          qty: (cols[2] || '').trim()
        };
      }).filter(p => p.fullName); // Ù†Ù„ØºÙŠ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
      displayProducts(products);
    })
    .catch(err => {
      body.innerHTML = `<tr><td colspan="3" style="color:red">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${err.message}</td></tr>`;
      console.error(err);
    });

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  function displayProducts(list){
    if (!list || list.length === 0) {
      body.innerHTML = `<tr><td colspan="3">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©</td></tr>`;
      return;
    }
    body.innerHTML = '';
    for (const p of list) {
      const price = p.price || '-';
      const qty = p.qty || '-';
      body.innerHTML += `<tr>
        <td>${escapeHtml(p.fullName)}</td>
        <td>${escapeHtml(price)}</td>
        <td>${escapeHtml(qty)}</td>
      </tr>`;
    }
  }

  // ÙÙ„ØªØ±Ø© Ù…Ø¹ ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø´Ø±Ø·Ø§Øª
  function filterProducts(){
    const w = widthSelect.value.trim();
    const a = aspectSelect.value.trim();
    const d = diameterSelect.value.trim();

    let filtered = products.slice();

    if (w) {
      const normW = normalize(w);
      filtered = filtered.filter(p => normalize(p.fullName).includes(normW));
    }
    if (a) {
      const normA = normalize(a);
      filtered = filtered.filter(p => normalize(p.fullName).includes(normA));
    }
    if (d) {
      const normD = 'R' + String(d).toUpperCase();
      filtered = filtered.filter(p => normalize(p.fullName).includes(normD));
    }

    displayProducts(filtered);
  }

  // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ÙÙ„ØªØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ùˆ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ select (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø£Ù† ÙŠØ¹Ù…Ù„ ÙÙˆØ±ÙŠ)
  searchBtn.addEventListener('click', filterProducts);
  widthSelect.addEventListener('change', filterProducts);
  aspectSelect.addEventListener('change', filterProducts);
  diameterSelect.addEventListener('change', filterProducts);

  // Ø¯Ø§Ù„Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø¹Ø±Ø¶ HTML Ù†ØµÙŠ
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }
</script>

</body>
</html>