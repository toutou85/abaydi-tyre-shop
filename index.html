<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>عبايدي للعجلات</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
    header { background-color: #007bff; color: white; padding: 1rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    header img { height: 40px; margin-left: 10px; }
    .searchBox { width: 95%; margin: 1rem auto; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
    select, button, input { padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; padding: 1rem; }
    .product { background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center; }
    .product img { width: 100%; height: auto; border-radius: 10px; }
    .pagination { text-align: center; margin: 2rem 0; }
    .pagination button { margin: 0 10px; padding: 0.6rem 1.2rem; background: #007bff; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; }
  </style>
</head>
<body>
<header>
  <div style="display: flex; align-items: center;">
    <img src="logo.png" alt="شعار المتجر">
    <span>متجر عبايدي للعجلات</span>
  </div>
</header>

<!-- ✅ البحث بالقوائم والنص -->
<div class="searchBox">
  <select id="width">
    <option value="">الكل (العرض)</option>
    <option value="135">135</option>
    <option value="145">145</option>
    <option value="155">155</option>
    <option value="165">165</option>
    <option value="175">175</option>
    <option value="185">185</option>
    <option value="195">195</option>
    <option value="205">205</option>
    <option value="215">215</option>
    <option value="225">225</option>
    <option value="235">235</option>
    <option value="245">245</option>
    <option value="255">255</option>
    <option value="265">265</option>
    <option value="275">275</option>
    <option value="285">285</option>
    <option value="295">295</option>
    <option value="305">305</option>
    <option value="315">315</option>
  </select>

  <span>/</span>

  <select id="height">
    <option value="">الكل (الارتفاع)</option>
    <option value="30">30</option>
    <option value="35">35</option>
    <option value="40">40</option>
    <option value="45">45</option>
    <option value="50">50</option>
    <option value="55">55</option>
    <option value="60">60</option>
    <option value="65">65</option>
    <option value="70">70</option>
    <option value="75">75</option>
    <option value="80">80</option>
    <option value="85">85</option>
  </select>

  <span>R</span>

  <select id="diameter">
    <option value="">الكل (القطر)</option>
    <option value="12">R12</option>
    <option value="13">R13</option>
    <option value="14">R14</option>
    <option value="15">R15</option>
    <option value="16">R16</option>
    <option value="17">R17</option>
    <option value="18">R18</option>
    <option value="19">R19</option>
    <option value="20">R20</option>
    <option value="21">R21</option>
    <option value="22">R22</option>
  </select>

  <!-- ✅ حقل بحث حر -->
  <input type="text" id="freeSearch" placeholder="مثال: R14 أو 185/65">

  <button onclick="filterProducts()">🔍 بحث</button>
</div>

<section class="products" id="productList"></section>
<div class="pagination" id="pagination"></div>

<script>
  let products = [];

  fetch('https://script.google.com/macros/s/AKfycbxWbyMXyZp9id5DNCRorPKHe1TUtQ8leaBrNQ3sTZHC-IAlYG69vkrXiJ-a6f8IHh9t/exec')
    .then(res => res.json())
    .then(data => {
      products = data.map(p => ({
        fullName: p.fullName || '',
        price: p.price || '',
        quantity: p.quantity || '0',
        img: p.img || 'https://via.placeholder.com/250x200'
      }));
      displayProducts();
    });

  const perPage = 10;
  let currentPage = 1;

  function displayProducts(list = products) {
    const productList = document.getElementById('productList');
    productList.innerHTML = '';

    const start = (currentPage - 1) * perPage;
    const end = start + perPage;
    const currentItems = list.slice(start, end);

    currentItems.forEach(p => {
      const available = parseInt(p.quantity) > 0;
      const availability = available ? '✅ متوفر' : '❌ <span style="color:red;">غير متوفر</span>';
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <img src="${p.img}" alt="صورة المنتج">
        <h3>${p.fullName}</h3>
        <p>السعر: ${p.price} دج</p>
        <p>${availability}</p>
      `;
      productList.appendChild(div);
    });

    updatePagination(list);
  }

  function updatePagination(list = products) {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';
    const totalPages = Math.ceil(list.length / perPage);

    if (totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = '⬅️ السابق';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => { currentPage--; displayProducts(list); };

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'التالي ➡️';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => { currentPage++; displayProducts(list); };

    pagination.appendChild(prevBtn);
    pagination.appendChild(nextBtn);
  }

  window.filterProducts = function () {
    const w = document.getElementById('width').value;
    const h = document.getElementById('height').value;
    const d = document.getElementById('diameter').value;
    const freeSearch = document.getElementById('freeSearch').value.trim().toUpperCase();

    let filtered = products;

    if (w) filtered = filtered.filter(p => p.fullName.includes(w));
    if (h) filtered = filtered.filter(p => p.fullName.includes(h));
    if (d) filtered = filtered.filter(p => p.fullName.toUpperCase().includes(d.toUpperCase()));
    if (freeSearch) {
      let normalized = freeSearch.replace(/\s+/g, "").replace("/", "").toUpperCase();
      filtered = filtered.filter(p => p.fullName.replace(/\s+/g, "").replace("/", "").toUpperCase().includes(normalized));
    }

    currentPage = 1;
    if (filtered.length === 0) {
      document.getElementById('productList').innerHTML = "<p style='text-align:center;color:red;'>⚠️ لا توجد نتائج.</p>";
      document.getElementById('pagination').innerHTML = '';
      return;
    }
    displayProducts(filtered);
  }
</script>
</body>
</html>