<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>عبايدي للعجلات</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
    header { background-color: #007bff; color: white; padding: 1rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    header img { height: 40px; margin-left: 10px; }
    nav { display: flex; gap: 10px; justify-content: flex-end; width: 100%; }
    nav a { color: white; text-decoration: none; background: #0056b3; padding: 5px 10px; border-radius: 5px; }
    .searchBox { width: 90%; margin: 1rem auto; display: flex; justify-content: center; gap: 5px; }
    select, button { padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; padding: 1rem; }
    .product { background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center; }
    .product img { width: 100%; height: auto; border-radius: 10px; }
    .pagination { text-align: center; margin: 2rem 0; }
    .pagination button { margin: 0 10px; padding: 0.6rem 1.2rem; background: #007bff; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; }
  </style>
</head>
<body>
<header>
  <div style="display: flex; align-items: center;">
    <img src="logo.png" alt="شعار المتجر">
    <span>متجر عبايدي للعجلات</span>
  </div>
</header>

<!-- ✅ البحث بالقوائم -->
<div class="searchBox">
  <select id="width">
    <option value="">العرض</option>
    <option>165</option>
    <option>175</option>
    <option>185</option>
    <option>195</option>
    <option>205</option>
    <option>215</option>
  </select>
  <span>/</span>
  <select id="height">
    <option value="">الارتفاع</option>
    <option>60</option>
    <option>65</option>
    <option>70</option>
    <option>75</option>
  </select>
  <span>R</span>
  <select id="diameter">
    <option value="">القطر</option>
    <option>13</option>
    <option>14</option>
    <option>15</option>
    <option>16</option>
    <option>17</option>
  </select>
  <button onclick="filterProducts()">🔍 بحث</button>
</div>

<section class="products" id="productList"></section>
<div class="pagination" id="pagination"></div>

<script>
  let products = [];

  fetch('https://script.google.com/macros/s/AKfycbxWbyMXyZp9id5DNCRorPKHe1TUtQ8leaBrNQ3sTZHC-IAlYG69vkrXiJ-a6f8IHh9t/exec')
    .then(res => res.json())
    .then(data => {
      products = data.map(p => ({
        fullName: p.fullName || '',
        price: p.price || '',
        quantity: p.quantity || '0',
        img: p.img || 'https://via.placeholder.com/250x200'
      }));
      displayProducts();
    });

  const perPage = 10;
  let currentPage = 1;

  function displayProducts(list = products) {
    const productList = document.getElementById('productList');
    productList.innerHTML = '';

    const start = (currentPage - 1) * perPage;
    const end = start + perPage;
    const currentItems = list.slice(start, end);

    currentItems.forEach(p => {
      const available = parseInt(p.quantity) > 0;
      const availability = available ? '✅ متوفر' : '❌ <span style="color:red;">غير متوفر</span>';
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <img src="${p.img}" alt="صورة المنتج">
        <h3>${p.fullName}</h3>
        <p>السعر: ${p.price} دج</p>
        <p>${availability}</p>
      `;
      productList.appendChild(div);
    });

    updatePagination(list);
  }

  function updatePagination(list = products) {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';
    const totalPages = Math.ceil(list.length / perPage);

    if (totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = '⬅️ السابق';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => { currentPage--; displayProducts(list); };

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'التالي ➡️';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => { currentPage++; displayProducts(list); };

    pagination.appendChild(prevBtn);
    pagination.appendChild(nextBtn);
  }

  window.filterProducts = function () {
    const w = document.getElementById('width').value;
    const h = document.getElementById('height').value;
    const d = document.getElementById('diameter').value;

    if (!w || !h || !d) {
      displayProducts(products);
      return;
    }

    const query = `${w} / ${h} R ${d}`;
    const filtered = products.filter(p =>
      p.fullName.includes(w) && p.fullName.includes(h) && p.fullName.includes(d)
    );

    currentPage = 1;
    if (filtered.length === 0) {
      document.getElementById('productList').innerHTML = "<p style='text-align:center;color:red;'>⚠️ لا توجد نتائج.</p>";
      document.getElementById('pagination').innerHTML = '';
      return;
    }
    displayProducts(filtered);
  }
</script>
</body>
</html>